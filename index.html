<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respect RP | Twitter</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --bg-color: #000000;
            --border-color: #2f3336;
            --twitter-blue: #1d9bf0;
            --text-white: #e7e9ea;
            --text-gray: #71767b;
            --hover-gray: rgba(231, 233, 234, 0.1);
            --like-color: #f91880;
            --retweet-color: #00ba7c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-white); display: flex; justify-content: center; min-height: 100vh; }

        .layout { display: grid; grid-template-columns: 275px 600px 350px; gap: 0; width: 100%; max-width: 1265px; height: 100vh; }

        /* Sidebar */
        .sidebar { padding: 20px 10px; position: sticky; top: 0; height: 100vh; display: flex; flex-direction: column; border-left: 1px solid var(--border-color); }
        .logo { font-size: 2rem; color: var(--text-white); margin-bottom: 20px; padding-right: 15px; display: block; }
        .menu-item { display: flex; align-items: center; gap: 20px; padding: 12px 25px 12px 15px; font-size: 1.3rem; font-weight: 700; color: var(--text-white); text-decoration: none; border-radius: 30px; transition: 0.2s; width: fit-content; margin-bottom: 5px; cursor: pointer; }
        .menu-item:hover { background-color: var(--hover-gray); }
        .menu-item.active { font-weight: 900; }
        .tweet-btn-side { background-color: var(--twitter-blue); color: white; border: none; border-radius: 30px; padding: 15px 0; width: 90%; font-size: 1.1rem; font-weight: 800; margin-top: 15px; cursor: pointer; transition: 0.2s; }
        .tweet-btn-side:hover { background-color: #1a8cd8; }
        
        .user-profile { margin-top: auto; display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: 30px; cursor: pointer; transition: 0.2s; display: none; }
        .user-profile.show { display: flex; }
        .user-profile:hover { background-color: var(--hover-gray); }
        .user-img { width: 40px; height: 40px; border-radius: 50%; background: #333; object-fit: cover; }
        .user-info h4 { font-size: 0.95rem; margin-bottom: -3px; }
        .user-info span { font-size: 0.9rem; color: var(--text-gray); direction: ltr; display: block; text-align: right;}

        /* Feed */
        .feed { border-left: 1px solid var(--border-color); overflow-y: scroll; -ms-overflow-style: none; scrollbar-width: none; }
        .feed::-webkit-scrollbar { display: none; }
        .header { position: sticky; top: 0; background-color: rgba(0, 0, 0, 0.65); backdrop-filter: blur(12px); padding: 15px; font-size: 1.2rem; font-weight: 800; border-bottom: 1px solid var(--border-color); z-index: 10; }

        .mobile-login-widget { display: none; padding: 15px; border-bottom: 1px solid var(--border-color); text-align: center; }

        .tweet-box { padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; gap: 15px; opacity: 0.5; pointer-events: none; transition: 0.3s; flex-direction: column; }
        .tweet-box.active { opacity: 1; pointer-events: auto; }
        .tweet-box-content { display: flex; gap: 15px; width: 100%; }
        .tweet-input { width: 100%; background: transparent; border: none; outline: none; color: var(--text-white); font-size: 1.3rem; resize: none; margin-top: 10px; }
        
        .tweet-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border-color); }
        .icons i { color: var(--twitter-blue); font-size: 1.1rem; padding: 8px; border-radius: 50%; cursor: pointer; margin-left: 5px; transition: 0.2s; }
        .icons i:hover { background-color: rgba(29, 155, 240, 0.1); }
        .tweet-btn-small { background-color: var(--twitter-blue); color: white; border: none; padding: 8px 20px; border-radius: 20px; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .tweet-btn-small:hover { background-color: #1a8cd8; }
        .tweet-btn-small:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Preview Image Area */
        #imagePreviewArea { display: none; margin-top: 10px; position: relative; }
        #imagePreviewArea img { width: 100%; max-height: 300px; object-fit: cover; border-radius: 15px; border: 1px solid var(--border-color); }
        #removeImageBtn { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; }
        .uploading-text { color: var(--twitter-blue); font-size: 0.9rem; font-weight: bold; margin-top: 5px; display: none; }

        /* Post Styles */
        .post { padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 12px; transition: 0.2s; animation: fadeIn 0.5s ease; }
        .post-main-content { display: flex; gap: 12px; width: 100%; }
        .post:hover { background-color: rgba(255, 255, 255, 0.03); }
        .post-avatar img { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; }
        .post-content { width: 100%; }
        .post-header { display: flex; align-items: center; gap: 5px; margin-bottom: 4px; }
        .name { font-weight: 800; font-size: 1rem; }
        .verified-badge { color: var(--twitter-blue); font-size: 0.9rem; margin-right: 3px; }
        .username, .time { color: var(--text-gray); font-size: 0.95rem; direction: ltr; }
        .post-text { font-size: 1rem; line-height: 1.5; margin-bottom: 10px; white-space: pre-wrap; word-wrap: break-word; }
        .post-footer { display: flex; justify-content: space-between; margin-top: 12px; color: var(--text-gray); max-width: 450px; }
        .action { display: flex; align-items: center; gap: 5px; font-size: 0.9rem; cursor: pointer; transition: 0.2s; }
        .action:hover.blue { color: var(--twitter-blue); }
        .action:hover.green { color: var(--retweet-color); }
        .action:hover.pink { color: var(--like-color); }
        
        .comments-section { margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color); display: none; }
        .comment-item { display: flex; gap: 10px; margin-bottom: 12px; }
        .comment-avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
        .comment-body { background-color: #16181c; padding: 10px 15px; border-radius: 16px; width: 100%; }
        .comment-name { font-weight: bold; font-size: 0.9rem; margin-bottom: 3px; display: flex; align-items: center; gap: 5px; }
        .comment-text { font-size: 0.95rem; white-space: pre-wrap; word-wrap: break-word;}
        .comment-input-area { display: flex; gap: 10px; margin-top: 10px; }
        .comment-input-area input { flex: 1; padding: 10px 15px; border-radius: 20px; background: #202327; border: none; color: white; outline: none; }
        .comment-input-area button { background: var(--twitter-blue); border: none; color: white; padding: 0 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }

        .widgets { padding: 10px 20px; height: 100vh; overflow-y: hidden; }
        .search { background-color: #202327; padding: 10px 20px; border-radius: 30px; display: flex; align-items: center; gap: 15px; margin-bottom: 20px; border: 1px solid transparent; }
        .search:focus-within { background-color: black; border-color: var(--twitter-blue); }
        .search input { background: transparent; border: none; outline: none; color: white; width: 100%; }

        .login-widget { background-color: #16181c; border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid #5865F2; text-align: center; }
        .discord-btn { background-color: #5865F2; color: white; border: none; width: 100%; padding: 12px; border-radius: 30px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 10px; }
        .discord-btn:hover { background-color: #4752C4; }
        .official-btn { background-color: transparent; color: var(--text-gray); border: 1px solid var(--border-color); width: 100%; padding: 10px; border-radius: 30px; font-size: 0.9rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .official-btn:hover { background-color: rgba(255, 255, 255, 0.1); color: white; }

        .trends-box { background-color: #16181c; border-radius: 16px; padding: 15px; }
        .trends-header { font-size: 1.3rem; font-weight: 800; margin-bottom: 15px; }
        .trend-item { padding: 10px 0; border-bottom: 1px solid var(--border-color); cursor: pointer; }
        .trend-item:last-child { border: none; }
        .trend-meta { font-size: 0.8rem; color: var(--text-gray); display: flex; justify-content: space-between; }
        .trend-name { font-weight: 700; margin: 2px 0; direction: ltr; text-align: right;}

        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .modal-overlay.show { display: flex; }
        .modal-box { background: #000; border: 1px solid var(--border-color); border-radius: 16px; padding: 25px; width: 90%; max-width: 450px; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; color: var(--text-gray); font-size: 0.9rem; }
        .input-group input { width: 100%; padding: 12px; background: #16181c; border: 1px solid var(--border-color); border-radius: 8px; color: white; outline: none; transition: 0.2s; }
        .input-group input:focus { border-color: var(--twitter-blue); }
        .modal-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 25px; width: 100%; }
        .modal-actions button { padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; border: none; }
        .btn-cancel { background: transparent; color: white; border: 1px solid var(--border-color) !important; }
        .btn-save { background: white; color: black; }
        .btn-logout { background: #f91880 !important; color: white !important; border: none !important; }
        .btn-logout:hover { background: #e01673 !important; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 1280px) {
            .layout { grid-template-columns: 80px 1fr 300px; }
            .menu-item span, .tweet-btn-side, .user-info, .logo span { display: none; }
            .menu-item { justify-content: center; padding: 15px; }
            .tweet-btn-side { display: block; width: 50px; height: 50px; border-radius: 50%; background-image: url('data:image/svg+xml;utf8,<svg fill="white" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.8 7.2H5.6V3.9c0-.4-.3-.8-.8-.8s-.7.4-.7.8v3.3H.8c-.4 0-.8.3-.8.8s.3.8.8.8h3.3v3.3c0 .4.3.8.8.8s.8-.3.8-.8V8.8h3.3c.4 0 .8-.3.8-.8s-.3-.8-.8-.8z"/></svg>'); padding: 0; }
        }
        @media (max-width: 1000px) {
            .layout { grid-template-columns: 80px 1fr; }
            .widgets { display: none; }
            .mobile-login-widget { display: block; }
        }
        @media (max-width: 600px) {
            .layout { display: block; }
            .sidebar { position: fixed; bottom: 0; top: auto; width: 100%; height: auto; flex-direction: row; justify-content: space-around; background: black; border-top: 1px solid var(--border-color); border-left: none; z-index: 100; padding: 10px; }
            .logo, .tweet-btn-side, .user-profile { display: none !important; }
            .header { display: none; }
            .feed { padding-bottom: 60px; border: none; }
        }
    </style>
</head>
<body>

    <div class="layout">
        <div class="sidebar">
            <a href="#" class="logo"><i class="fab fa-twitter"></i></a>
            <div class="menu-item active"><i class="fas fa-home"></i> <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></div>
            <div class="menu-item"><i class="fas fa-hashtag"></i> <span>Ø§Ø³ØªÙƒØ´Ø§Ù</span></div>
            <div class="menu-item"><i class="far fa-bell"></i> <span>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span></div>
            <div class="menu-item" onclick="openProfileModal()"><i class="far fa-user"></i> <span>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span></div>
            
            <button class="tweet-btn-side" onclick="document.getElementById('tweetInputText').focus()">ØºØ±Ø¯</button>

            <div class="user-profile" id="userProfileBtn" onclick="openProfileModal()">
                <img src="" id="sidebarAvatar" alt="" class="user-img">
                <div class="user-info">
                    <h4 id="sidebarName">Ø§Ù„Ø§Ø³Ù…</h4>
                    <span id="sidebarUser">@ÙŠÙˆØ²Ø±</span>
                </div>
                <i class="fas fa-ellipsis-h" style="margin-right: auto;"></i>
            </div>
        </div>

        <div class="feed">
            <div class="header">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>

            <div class="mobile-login-widget" id="mobileLogin">
                <button class="discord-btn" onclick="loginDiscord()"><i class="fab fa-discord"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯</button>
                <button class="official-btn" onclick="openOfficialLoginModal()">Ø¯Ø®ÙˆÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø­ÙƒÙˆÙ…ÙŠ ğŸ›ï¸</button>
            </div>

            <div class="tweet-box" id="tweetBoxArea">
                <div class="tweet-box-content">
                    <img src="" id="tweetAvatar" style="width: 48px; height: 48px; border-radius: 50%; object-fit: cover;" alt="">
                    <div style="width: 100%;">
                        <textarea class="tweet-input" id="tweetInputText" rows="2" placeholder="Ù…Ø§Ø°Ø§ ÙŠØ­Ø¯Ø« ÙÙŠ RespectØŸ"></textarea>
                        
                        <div id="imagePreviewArea">
                            <img id="previewImg" src="">
                            <button id="removeImageBtn" onclick="removeImage()">X</button>
                        </div>
                        <div class="uploading-text" id="uploadingText"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©...</div>

                        <div class="tweet-actions">
                            <div class="icons">
                                <i class="far fa-image" onclick="document.getElementById('imageUploadInput').click()" title="Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²"></i>
                                <input type="file" id="imageUploadInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                                <i class="fas fa-poll-h"></i>
                                <i class="far fa-smile"></i>
                            </div>
                            <button class="tweet-btn-small" id="sendTweetBtn" onclick="sendTweet()">ØºØ±Ø¯</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tweetsContainer">
                <div style="text-align: center; padding: 30px; color: var(--twitter-blue);">
                    <i class="fas fa-circle-notch fa-spin fa-2x"></i>
                    <p style="margin-top: 10px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...</p>
                </div>
            </div>
        </div>

        <div class="widgets">
            <div class="search">
                <i class="fas fa-search" style="color: #71767b;"></i>
                <input type="text" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Respect">
            </div>

            <div class="login-widget" id="desktopLogin">
                <h3>Ø§Ù†Ø¶Ù… Ù„Ù„Ù…Ø¯ÙŠÙ†Ø© ğŸ™ï¸</h3>
                <p>Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ†.</p>
                <button class="discord-btn" onclick="loginDiscord()"><i class="fab fa-discord"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯</button>
                <button class="official-btn" onclick="openOfficialLoginModal()">Ø¯Ø®ÙˆÙ„ Ù…Ø³Ø¤ÙˆÙ„ Ø­ÙƒÙˆÙ…ÙŠ ğŸ›ï¸</button>
            </div>

            <div class="trends-box">
                <div class="trends-header">Ù…Ø§Ø°Ø§ ÙŠØ­Ø¯Ø«</div>
                <div class="trend-item">
                    <div class="trend-meta"><span>Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Respect</span><i class="fas fa-ellipsis-h"></i></div>
                    <div class="trend-name">#ÙØ¹Ø§Ù„ÙŠØ§Øª_Ø±Ù…Ø¶Ø§Ù†</div>
                    <div class="trend-meta">5,400 ØªØºØ±ÙŠØ¯Ø©</div>
                </div>
                <div class="trend-item">
                    <div class="trend-meta"><span>Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ù„ÙˆØ³ Ø³Ø§Ù†ØªÙˆØ³</span><i class="fas fa-ellipsis-h"></i></div>
                    <div class="trend-name">#Ø§Ù„Ø´Ø±Ø·Ø©_ÙÙŠ_Ø®Ø¯Ù…Ø©_Ø§Ù„Ø´Ø¹Ø¨</div>
                    <div class="trend-meta">2,100 ØªØºØ±ÙŠØ¯Ø©</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="profileModal">
        <div class="modal-box">
            <h2 style="margin-bottom: 20px; font-size: 1.4rem;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
            <div class="input-group">
                <label>Ø§Ù„Ø§Ø³Ù… (RP Name)</label>
                <input type="text" id="editName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± Ù„Ù„Ù†Ø§Ø³">
            </div>
            <div class="input-group">
                <label>Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø³Ø§Ø¨ (Username)</label>
                <input type="text" id="editUsername" dir="ltr" placeholder="Ù…Ø«Ø§Ù„: Ahmed_RP">
            </div>
            <div class="input-group">
                <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (URL)</label>
                <input type="text" id="editAvatar" dir="ltr" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø§Ù†ØªØ±Ù†Øª">
            </div>
            <div class="modal-actions">
                <button class="btn-cancel btn-logout" onclick="logoutUser()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ <i class="fas fa-sign-out-alt"></i></button>
                
                <div style="display: flex; gap: 10px;">
                    <button class="btn-cancel" onclick="closeProfileModal()">Ø¥Ù„ØºØ§Ø¡</button>
                    <button class="btn-save" onclick="saveProfile()">Ø­ÙØ¸</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="officialLoginModal">
        <div class="modal-box">
            <h2 style="margin-bottom: 20px; font-size: 1.4rem;">ğŸ›ï¸ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­ÙƒÙˆÙ…ÙŠ</h2>
            <div class="input-group">
                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠ</label>
                <input type="email" id="officialEmail" dir="ltr" placeholder="email@respect.gov">
            </div>
            <div class="input-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="officialPassword" dir="ltr" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <div class="modal-actions" style="justify-content: flex-end;">
                <button class="btn-cancel" onclick="document.getElementById('officialLoginModal').classList.remove('show')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-save" onclick="loginOfficial()">Ø¯Ø®ÙˆÙ„</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. Firebase Config
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyCQjQyGAII2ZJAKUpeocgkc35LtEiXFfBg",
            authDomain: "respecttwitter-861bc.firebaseapp.com",
            databaseURL: "https://respecttwitter-861bc-default-rtdb.firebaseio.com",
            projectId: "respecttwitter-861bc",
            storageBucket: "respecttwitter-861bc.appspot.com",
            messagingSenderId: "799515116421",
            appId: "1:799515116421:web:91bc72299c6d1876b8faec"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ==========================================
        // 2. Constants & Data
        // ==========================================
        const WEBHOOK_URL = "webhook.php"; 
        const DISCORD_CLIENT_ID = "1474593647604404427"; 
        const REDIRECT_URI = encodeURIComponent("https://testtttt123.netlify.app/"); 
        
        const OFFICIAL_ACCOUNTS = [
            {
                email: "justice@respect.gov",
                pass: "respect123",
                name: "ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¹Ø¯Ù„",
                username: "MinistryOfJustice",
                avatar: "https://ui-avatars.com/api/?name=Justice&background=0D47A1&color=fff", 
                isVerified: true
            },
            {
                email: "interior@respect.gov",
                pass: "respect123",
                name: "ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©",
                username: "MinistryOfInterior",
                avatar: "https://ui-avatars.com/api/?name=MOI&background=1B5E20&color=fff",
                isVerified: true
            },
            {
                email: "defense@respect.gov",
                pass: "respect123",
                name: "ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ§Ø¹",
                username: "MinistryOfDefense",
                avatar: "https://ui-avatars.com/api/?name=MOD&background=3E2723&color=fff",
                isVerified: true
            },
            {
                email: "court@respect.gov",
                pass: "respect123",
                name: "Ù…Ø¬Ù„Ø³ Ø§Ù„Ù‚Ø¶Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù„Ù‰",
                username: "SupremeCourt",
                avatar: "https://ui-avatars.com/api/?name=Court&background=4A148C&color=fff",
                isVerified: true
            }
        ];

        let currentUser = null;
        let currentImageURL = "";
        let tweets = [];

        window.addEventListener('DOMContentLoaded', () => {
            checkDiscordLogin();
            loadTweetsFromFirebase();
        });

        // --- Official Login Logic (ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡) ---
        function openOfficialLoginModal() {
            document.getElementById('officialLoginModal').classList.add('show');
        }

        function loginOfficial() {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… toLowerCase() Ù„Ù…Ù†Ø¹ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ Ø§Ù„Ø°ÙŠ ÙŠØ¶ÙŠÙ Ø­Ø±ÙˆÙ ÙƒØ¨ÙŠØ±Ø©
            const email = document.getElementById('officialEmail').value.trim().toLowerCase();
            const pass = document.getElementById('officialPassword').value.trim();

            const account = OFFICIAL_ACCOUNTS.find(acc => acc.email.toLowerCase() === email && acc.pass === pass);

            if (account) {
                currentUser = {
                    name: account.name,
                    username: account.username,
                    avatar: account.avatar,
                    isVerified: true 
                };
                localStorage.setItem('rp_twitter_user', JSON.stringify(currentUser));
                applyUserData();
                document.getElementById('officialLoginModal').classList.remove('show');
            } else {
                alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©! ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.");
            }
        }

        // --- Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ---
        function logoutUser() {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {
                localStorage.removeItem('rp_twitter_user');
                window.location.href = window.location.pathname; // Ø¹Ù…Ù„ Ø±ÙŠÙØ±Ø´ ÙˆØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø§Ø¨Ø·
            }
        }

        // --- Discord Login Logic ---
        function loginDiscord() {
            const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=token&scope=identify`;
            window.location.href = authUrl;
        }

        function checkDiscordLogin() {
            const hash = window.location.hash;
            let storedUser = localStorage.getItem('rp_twitter_user');

            if (hash && hash.includes("access_token")) {
                const params = new URLSearchParams(hash.substring(1));
                const token = params.get('access_token');
                fetchDiscordProfile(token);
                window.history.replaceState(null, null, window.location.pathname);
            } else if (storedUser) {
                currentUser = JSON.parse(storedUser);
                applyUserData();
            }
        }

        function fetchDiscordProfile(token) {
            fetch('https://discord.com/api/users/@me', {
                headers: { Authorization: `Bearer ${token}` }
            })
            .then(res => res.json())
            .then(data => {
                let avatarUrl = data.avatar 
                    ? `https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png` 
                    : `https://ui-avatars.com/api/?name=${data.username}&background=5865F2&color=fff`;

                currentUser = {
                    name: data.global_name || data.username,
                    username: data.username.replace(/\s+/g, '_'),
                    avatar: avatarUrl,
                    isVerified: false 
                };
                localStorage.setItem('rp_twitter_user', JSON.stringify(currentUser));
                applyUserData();
                openProfileModal();
            })
            .catch(err => console.error(err));
        }

        function applyUserData() {
            if(!currentUser) return;
            document.getElementById('sidebarName').innerText = currentUser.name;
            document.getElementById('sidebarUser').innerText = "@" + currentUser.username;
            document.getElementById('sidebarAvatar').src = currentUser.avatar;
            document.getElementById('tweetAvatar').src = currentUser.avatar;
            document.getElementById('desktopLogin').style.display = 'none';
            document.getElementById('mobileLogin').style.display = 'none';
            document.getElementById('userProfileBtn').classList.add('show');
            document.getElementById('tweetBoxArea').classList.add('active');
        }

        // --- Image Upload ---
        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            document.getElementById('uploadingText').style.display = 'block';
            document.getElementById('sendTweetBtn').disabled = true;

            const formData = new FormData();
            formData.append('image', file);

            try {
                const res = await fetch('https://api.imgbb.com/1/upload?key=41b97431d1be0a9cd4614eb1c85eaba1', {
                    method: 'POST',
                    body: formData
                });
                const data = await res.json();
                if (data.success) {
                    currentImageURL = data.data.url;
                    document.getElementById('previewImg').src = currentImageURL;
                    document.getElementById('imagePreviewArea').style.display = 'block';
                    document.getElementById('removeImageBtn').style.display = 'block';
                } else {
                    throw new Error("ImgBB Failed");
                }
            } catch (err) {
                try {
                    const fallbackForm = new FormData();
                    fallbackForm.append('file', file);
                    const res2 = await fetch('https://tmpfiles.org/api/v1/upload', {
                        method: 'POST',
                        body: fallbackForm
                    });
                    const data2 = await res2.json();
                    if(data2.status === 'success') {
                        currentImageURL = data2.data.url.replace('tmpfiles.org/', 'tmpfiles.org/dl/');
                        document.getElementById('previewImg').src = currentImageURL;
                        document.getElementById('imagePreviewArea').style.display = 'block';
                        document.getElementById('removeImageBtn').style.display = 'block';
                    } else { throw new Error("Fallback Failed"); }
                } catch (err2) {
                    alert("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
                    currentImageURL = "";
                }
            }
            document.getElementById('uploadingText').style.display = 'none';
            document.getElementById('sendTweetBtn').disabled = false;
            event.target.value = ""; 
        }

        function removeImage() {
            currentImageURL = "";
            document.getElementById('imagePreviewArea').style.display = 'none';
        }

        // --- Send Tweet ---
        function sendTweet() {
            const text = document.getElementById('tweetInputText').value.trim();
            if((!text && !currentImageURL) || !currentUser) return;

            const btn = document.getElementById('sendTweetBtn');
            btn.innerText = "Ø¬Ø§Ø±ÙŠ...";
            btn.disabled = true;

            const tweetId = Date.now().toString();
            const newTweet = {
                id: tweetId,
                name: currentUser.name,
                username: currentUser.username,
                avatar: currentUser.avatar,
                text: text,
                image: currentImageURL,
                time: "Ø§Ù„Ø¢Ù†",
                likes: 0,
                retweets: 0,
                comments: {},
                isVerified: currentUser.isVerified || false 
            };

            database.ref('tweets/' + tweetId).set(newTweet).then(() => {
                if(WEBHOOK_URL) {
                    const payload = {
                        embeds: [{
                            author: {
                                name: `${currentUser.name} (@${currentUser.username})`,
                                icon_url: currentUser.avatar
                            },
                            description: text,
                            color: 0x1d9bf0 
                        }]
                    };
                    if (currentImageURL && currentImageURL.startsWith('http')) {
                        payload.embeds[0].image = { url: currentImageURL };
                    }
                    fetch(WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    }).catch(console.error);
                }

                document.getElementById('tweetInputText').value = "";
                removeImage();
                btn.innerText = "ØºØ±Ø¯";
                btn.disabled = false;
            }).catch(error => {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„");
                btn.innerText = "ØºØ±Ø¯";
                btn.disabled = false;
            });
        }

        // --- Load Tweets (Ù…Ø¹ Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ÙƒØ³ÙˆØ±Ø©) ---
        function loadTweetsFromFirebase() {
            database.ref('tweets').on('value', (snapshot) => {
                tweets = [];
                snapshot.forEach((childSnapshot) => {
                    tweets.push(childSnapshot.val());
                });
                tweets.sort((a, b) => parseInt(b.id) - parseInt(a.id));
                renderTweets();
            });
        }

        function renderTweets() {
            const container = document.getElementById('tweetsContainer');
            container.innerHTML = ""; 
            
            if(tweets.length === 0) {
                container.innerHTML = "<div style='text-align:center; padding: 20px; color:#71767b;'>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºØ±ÙŠØ¯Ø§ØªØŒ ÙƒÙÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØºØ±Ø¯!</div>";
                return;
            }

            tweets.forEach(tweet => {
                // Ø­Ù…Ø§ÙŠØ© Ù„Ø¹Ø¯Ù… Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ÙƒØ³ÙˆØ±Ø©
                let imageHTML = "";
                if (tweet.image && tweet.image.trim() !== "" && tweet.image.startsWith('http')) {
                    imageHTML = `<div style="margin-top: 12px;"><img src="${tweet.image}" style="width: 100%; border-radius: 16px; border: 1px solid #2f3336; max-height: 400px; object-fit: cover; display: block;"></div>`;
                }

                let commentsCount = tweet.comments ? Object.keys(tweet.comments).length : 0;
                let verifiedBadge = tweet.isVerified ? `<i class="fas fa-check-circle verified-badge" title="Ø­Ø³Ø§Ø¨ Ø±Ø³Ù…ÙŠ"></i>` : '';

                let commentsHTML = "";
                if(tweet.comments) {
                    Object.values(tweet.comments).forEach(comment => {
                        let commentBadge = comment.isVerified ? `<i class="fas fa-check-circle verified-badge" style="font-size:0.8rem;"></i>` : '';
                        commentsHTML += `
                            <div class="comment-item">
                                <img src="${comment.avatar}" class="comment-avatar">
                                <div class="comment-body">
                                    <div class="comment-name">${comment.name} ${commentBadge} <span style="color:#71767b; font-weight:normal; font-size:0.8rem;">@${comment.username}</span></div>
                                    <div class="comment-text">${comment.text}</div>
                                </div>
                            </div>
                        `;
                    });
                }

                const html = `
                <div class="post" id="post-${tweet.id}">
                    <div class="post-main-content">
                        <div class="post-avatar"><img src="${tweet.avatar}" alt=""></div>
                        <div class="post-content">
                            <div class="post-header">
                                <span class="name">${tweet.name}</span>
                                ${verifiedBadge}
                                <span class="username">@${tweet.username}</span>
                            </div>
                            <div class="post-text">${tweet.text}</div>
                            ${imageHTML}
                            <div class="post-footer">
                                <div class="action blue" onclick="toggleComments('${tweet.id}')">
                                    <i class="far fa-comment"></i> <span>${commentsCount}</span>
                                </div>
                                <div class="action green" onclick="addInteract('${tweet.id}', 'retweets', ${tweet.retweets || 0})">
                                    <i class="fas fa-retweet"></i> <span>${tweet.retweets || 0}</span>
                                </div>
                                <div class="action pink" onclick="addInteract('${tweet.id}', 'likes', ${tweet.likes || 0})">
                                    <i class="far fa-heart"></i> <span>${tweet.likes || 0}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="comments-section" id="comments-${tweet.id}">
                        ${commentsHTML}
                        <div class="comment-input-area">
                            <input type="text" id="comment-input-${tweet.id}" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ Ù‡Ù†Ø§...">
                            <button onclick="sendComment('${tweet.id}')">Ø±Ø¯</button>
                        </div>
                    </div>
                </div>`;
                
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        function addInteract(tweetId, type, currentCount) {
            if (!currentUser) return alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!");
            database.ref('tweets/' + tweetId + '/' + type).set((currentCount || 0) + 1);
        }

        function toggleComments(tweetId) {
            const section = document.getElementById('comments-' + tweetId);
            if(section) section.style.display = section.style.display === 'block' ? 'none' : 'block';
        }

        function sendComment(tweetId) {
            if (!currentUser) return alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!");
            const inputField = document.getElementById('comment-input-' + tweetId);
            const text = inputField.value.trim();
            if (text !== "") {
                const newComment = {
                    name: currentUser.name,
                    username: currentUser.username,
                    avatar: currentUser.avatar,
                    text: text,
                    isVerified: currentUser.isVerified || false,
                    time: Date.now()
                };
                database.ref('tweets/' + tweetId + '/comments').push(newComment);
                inputField.value = ""; 
            }
        }

        function openProfileModal() {
            if(!currentUser) return;
            document.getElementById('editName').value = currentUser.name;
            document.getElementById('editUsername').value = currentUser.username;
            document.getElementById('editAvatar').value = currentUser.avatar;
            document.getElementById('profileModal').classList.add('show');
        }

        function closeProfileModal() { document.getElementById('profileModal').classList.remove('show'); }

        function saveProfile() {
            const newName = document.getElementById('editName').value.trim();
            const newUsername = document.getElementById('editUsername').value.trim().replace(/\s+/g, '_');
            const newAvatar = document.getElementById('editAvatar').value.trim();
            if(!newName || !newUsername) { alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©!"); return; }
            
            currentUser.name = newName;
            currentUser.username = newUsername;
            currentUser.avatar = newAvatar || currentUser.avatar;
            
            localStorage.setItem('rp_twitter_user', JSON.stringify(currentUser));
            applyUserData();
            closeProfileModal();
        }
    </script>
</body>
</html>